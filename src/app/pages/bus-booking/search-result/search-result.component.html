<!--section main area-->
<div class="section" *ngIf="trip">
  <div class="container">
    <div class="section-main">
      <div class="ticket-area" [class]="selectedTrip ? 'active-border' : ''">
        <div class="ticket-info" (click)="onShowMobile($event)">
          <div class="ticket-search-info">
            <h3>{{ trip?.bus?.name }}</h3>
            <!-- <p>
              Coach Type: <span>{{ trip?.bus?.coachType }}</span>
            </p> -->
            <ul class="ticket-search-time">
              <li>
                <span>{{ trip?.departureTime?.name }}</span>
              </li>
              <li>
                <span>{{ trip?.arrivalTime?.name }}</span>
              </li>
            </ul>
            <ul class="ticket-search-point">
              <li>
                Starting Point: <span>{{ trip?.from?.name }}</span>
              </li>
              <li>
                End Point: <span>{{ trip?.to?.name }}</span>
              </li>
            </ul>
          </div>

          <div class="ticket-time-info">
            <h4>DEPARTURE</h4>
            <h4>Time</h4>
            <span>{{ trip?.departureTime?.name }}</span>
          </div>
          <div class="ticket-time-info">
            <h4>ARRIVAL</h4>
            <h4>Time</h4>
            <span>{{ trip?.arrivalTime?.name }}</span>
          </div>
          <div class="ticket-time-info">
            <h4>SEATS</h4>
            <h4>AVAILABLE</h4>
            <span>{{ trip?.bus?.totalSeat }}</span>
          </div>
          <div class="ticket-price-info">
            <div class="price">
              <!-- <span>{{ trip?.bus?.totalSeat }} Seats Available</span> -->
              <!-- <h3>à§³{{ trip?.price }}</h3> -->
            </div>
            <div class="ticket-control-btn">
              <button (click)="onShow($event)">
                {{ id ? "Hide Seats" : "Show Seats" }}
              </button>
              <span>Cancellation Policy</span>
            </div>
          </div>
        </div>
        <div class="ticket-details-area" *ngIf="selectedTrip">
          <div class="ticket-details-top">
            <ul>
              <li>
                <div [class]="'seat-plan'">
                  <img [src]="'/assets/images/seats/Available/singleChair.png'" alt="">
                </div>
                <div class="seat-type">
                  <h3>Available</h3>
                </div>
              </li>

              <li>
                <div [class]="'seat-plan booked'">
                  <img [src]="'/assets/images/seats/Booked/singleChair.png'" alt="">
                </div>
                <div class="seat-type">
                  <h3>BOOKED</h3>
                </div>
              </li>
              
              <li>
                <div [class]="'seat-plan blocked'">
                  <img [src]="'/assets/images/seats/Blocked/singleChair.png'" alt="">
                </div>
                <div class="seat-type">
                  <h3>BLOCKED</h3>
                </div>
              </li>

              <li>
                <div [class]="'seat-plan selected'">
                  <img [src]="'/assets/images/seats/Selected/singleChair.png'" alt="">
                </div>
                <div class="seat-type">
                  <h3>SELECTED</h3>
                </div>
              </li>

              <li>
                <div [class]="'seat-plan'">
                  <img class="sold" [src]="'/assets/images/seats/Sold/singleChair.png'" alt="">
                </div>
                <div class="seat-type">
                  <h3>SOLD</h3>
                </div>
              </li>

              <!-- <li>
                <div style="justify-self: center; width: 26px; height: 30px">
                  <span class="seat sold-f">
                    <div class="hand"></div>
                  </span>
                </div>
                <div class="seat-type">
                  <h3>SOLD (F)</h3>
                </div>
              </li> -->
            </ul>
            <div class="floor-container">
              <div [class]="floorSelected === '1' ? 'floor floor-active' : 'floor'" (click)="onToggleFloor('1')">
                Floor 1
              </div>
              <div [class]="floorSelected === '2' ? 'floor floor-active' : 'floor'" (click)="onToggleFloor('2')">
                Floor 2
              </div>
              <div [class]="floorSelected === '3' ? 'floor floor-active' : 'floor'" (click)="onToggleFloor('3')">
                Floor 3
              </div>

              <div [class]="floorSelected === '4' ? 'floor floor-active' : 'floor'" (click)="onToggleFloor('4')">
                Floor 4
              </div>
            </div>
          </div>
          <div class="ticket-details-main">
            <div class="seat-area">
              <div class="seat-area-main">
                <div class="seat-area-top">
                  <img src="https://bdtickets.com/images/driver-icon.webp" alt="" />
                </div>
                <ul>
                  <ng-container *ngFor="let data of selectedTrip?.seats">
                    <li *ngIf="data?.floorNo === floorSelected" [ngStyle]="{
                      'grid-row-start': data?.xaxis,
                      'grid-column-start': data?.yaxis
                    }">
                      <div (click)="onSelectSeat(data, selectedTrip)" [class]="'seat-plan'">
                        <img [class]="data?.status === 'Selected' ? 'selected' 
                  : data?.status === 'Sold' ? 'sold' 
                  : data?.status === 'Booked' ? 'booked' 
                  : data?.status === 'Blocked' ? 'blocked' 
                  :''" [src]="'/assets/images/seats/' + (data?.status ? data?.status : 'Available') + '/' + (data?.seatType ? data?.seatType : 'singleChair')  + '.png'"
                          alt="">
                        <span>{{data?.seatNo}}</span>
                        <span [matTooltip]="data.seatNo"></span>
                      </div>
                      <!-- <div
                      style="justify-self: center; width: 26px; height: 30px"
                      (click)="onSelectSeat(data, selectedTrip)"
                    >
                      <span
                        [matTooltip]="data.seatNo"
                        class="seat search_loader__PZ_xW"
                        [ngClass]="{
                          blocked: (data?.status | lowercase) === 'blocked',
                          'booked-m':
                            (data?.status | lowercase) === 'booked' &&
                            data?.gender === 'Female',
                          'booked-f': (data?.status | lowercase) === 'booked',
                          'sold-m': (data?.status | lowercase) === 'sold',
                          'sold-f':
                            (data?.status | lowercase) === 'sold' &&
                            data?.gender === 'Female',
                          search_loader__PZ_xW: data?.seatAnimation === true,
                          selected:
                            data?.seatAnimation === false &&
                            (data?.status | lowercase) === 'selected'
                        }"
                      >
                        <div
                          class="hand"
                          [ngClass]="{
                            search_hand__Yoq3T:
                              seatAnimation === true &&
                              data?._id === selectedSeat?._id
                          }"
                        ></div>
                      </span>
                    </div> -->
                    </li>
                  </ng-container>
                </ul>
              </div>
            </div>
            <div class="ticket-details-right">
              <div>
                <div class="boarding-info">
                  <div class="boarding-info-title">
                    <h3>
                      BOARDING/DROPPING <br />
                      POINT:
                    </h3>
                  </div>
                  <div class="boarding-info-selection-area">
                    <div class="boarding-info-select">
                      <h4>BOARDING POINT*</h4>
                      <div class="boarding-info-selected-btn" [ngClass]="{ error: isBoardingError }"
                        [matMenuTriggerFor]="menuBoarding">
                        <div class="boarding-selected-area-name">
                          <span>[{{ trip?.departureTime?.name }}]</span>
                          <h5>
                            {{
                            selectBoardingPoints
                            ? selectBoardingPoints?.name
                            : "Select counter"
                            }}
                          </h5>
                        </div>
                        <div class="boarding-info-icon">
                          <span><i class="fa fa-angle-down"></i></span>
                        </div>
                      </div>
                    </div>

                    <div class="boarding-info-select">
                      <h4>DROPPING POINT*</h4>
                      <div class="boarding-info-selected-btn" [matMenuTriggerFor]="menuDropping"
                        [ngClass]="{ error: isDroppingError }">
                        <div class="boarding-selected-area-name">
                          <span>[{{ trip?.arrivalTime?.name }}]</span>
                          <h5>
                            {{
                            selectDroppingPoints
                            ? selectDroppingPoints?.name
                            : "Select counter"
                            }}
                          </h5>
                        </div>
                        <div class="boarding-info-icon">
                          <span><i class="fa fa-angle-down"></i></span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="boarding-info-title">
                    <h3>SEAT INFORMATION:</h3>
                  </div>
                  <div class="seat-table-area" *ngIf="selectedSeats.length">
                    <table>
                      <thead>
                        <tr>
                          <th>Seats</th>
                          <th>Class</th>
                          <th>Fare</th>
                          <th *ngIf="mode === 'edit'">Act.</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let seat of selectedSeats; let i=index">
                          <td>
                            {{ seat?.seatNo }}
                            {{ seat?.type ? "- " + seat?.type : "" }}
                          </td>
                          <td>{{ seat?.seatType }}</td>
                          <!-- <td>à§³ {{ trip?.price }}</td> -->
                          <td *ngIf="mode !== 'edit'">à§³ {{ carts[i]?.price }}</td>
                          <td *ngIf="mode === 'edit'">à§³ {{ seat?.price }}</td>
                          <td *ngIf="mode === 'edit' && seat?.type !== 'new'">
                            <mat-icon (click)="onRemoveBookedSeat(seat)"
                              style="font-size: 16px; cursor: pointer">close</mat-icon>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <div class="boarding-info-title" *ngIf="canceledSeats.length">
                    <h3>Canceled Seats:</h3>
                  </div>
                  <div class="seat-table-area" *ngIf="canceledSeats.length">
                    <table>
                      <thead>
                        <tr>
                          <th>Seats</th>
                          <th>Class</th>
                          <th>Fare</th>
                          <th *ngIf="mode === 'edit'">Act.</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let seat of canceledSeats">
                          <td>{{ seat?.seatNo }}</td>
                          <td>{{ seat?.seatType }}</td>
                          <td>à§³ {{ trip?.price }}</td>
                          <td *ngIf="mode === 'edit'">
                            <mat-icon (click)="onRemoveCanceledSeat(seat)"
                              style="font-size: 16px; cursor: pointer">close</mat-icon>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <div class="seat-charge-area">
                    <ul>
                      <li>Seat Fare: à§³ {{ totalAmount }}</li>
                      <li>Service Charge: à§³ {{ serviceCharge }}</li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="user-log-in-info">
                <div class="passenger-information">
                  <form [formGroup]="dataForm" (ngSubmit)="onSubmit()">
                    <div class="passenger-info-title">
                      <h3>PASSENGER INFORMATION:</h3>
                    </div>
                    <div class="input-field-area">
                      <div class="form-field">
                        <label>PHONE NUMBER*</label>
                        <input type="tel" formControlName="phoneNo" digitOnly maxlength="11 " />
                        <span *ngIf="
                            dataForm.get('phoneNo')?.touched &&
                            dataForm.get('phoneNo')?.invalid
                          ">This field is required</span>
                      </div>
                      <div class="form-field">
                        <label>EMAIL</label>
                        <input type="email" formControlName="email" />
                        <span *ngIf="
                            dataForm.get('email')?.touched &&
                            dataForm.get('email')?.invalid
                          ">Invalid email address!</span>
                      </div>
                    </div>

                    <div class="input-field-area" style="
                        grid-template-columns: repeat(1, 1fr);
                        margin-top: 10px;
                      ">
                      <div class="form-field">
                        <label>NAME*</label>
                        <input type="text" formControlName="name" />
                        <span *ngIf="
                            dataForm.get('name')?.touched &&
                            dataForm.get('name')?.invalid
                          ">This field is required</span>
                      </div>
                    </div>

                    <div class="input-field-area" style="margin-top: 10px">
                      <div class="form-field">
                        <label>Ticket Type</label>
                        <select formControlName="ticketType">
                          <option value="Booked">Booked</option>
                          <option value="Sold">Issued</option>
                        </select>
                        <span *ngIf="
                            dataForm.get('ticketType')?.touched &&
                            dataForm.get('ticketType')?.invalid
                          ">This field is required</span>
                      </div>
                      <div class="form-field">
                        <label>Paid Amount</label>
                        <input type="number" formControlName="paidAmount" />
                        <span *ngIf="
                            dataForm.get('paidAmount')?.touched &&
                            dataForm.get('paidAmount')?.invalid
                          ">This field is required</span>
                      </div>
                    </div>

                    <div [style.display]="
                        dataForm.value['ticketType'] === 'Booked'
                          ? 'block'
                          : 'none'
                      " class="input-field-area" style="
                        grid-template-columns: repeat(1, 1fr);
                        margin-top: 10px;
                      ">
                      <div class="form-field">
                        <label>Booking Time</label>
                        <select formControlName="bookingTime" [required]="dataForm.value['ticketType'] === 'Booked'">
                          <option *ngFor="let data of bookingTimes" [value]="data.value">
                            {{ data.viewValue }}
                          </option>
                        </select>
                        <span *ngIf="
                            dataForm.get('bookingTime')?.touched &&
                            dataForm.get('bookingTime')?.invalid
                          ">This field is required</span>
                      </div>
                    </div>

                    <div class="gender-btn">
                      <h4>Gender*</h4>
                      <ul>
                        <li>
                          <button type="button" [class]="selectedGender === 'Male' ? 'active' : ''"
                            (click)="onSelectGender('Male')">
                            Male
                          </button>
                        </li>
                        <li>
                          <button type="button" [class]="
                              selectedGender === 'Female' ? 'active' : ''
                            " (click)="onSelectGender('Female')">
                            Female
                          </button>
                        </li>
                      </ul>
                    </div>
                    <div class="sub-btn">
                      <button *ngIf="!isLoading" type="submit">Proceed</button>
                      <button style="opacity: 0.8" *ngIf="isLoading" type="button">
                        Please wai...
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<mat-menu #menuBoarding="matMenu">
  <button mat-menu-item *ngFor="let b of trip?.boardingPoints" (click)="onSelectBoardingPoint(b)">
    {{ b?.name }}
  </button>
</mat-menu>

<mat-menu #menuDropping="matMenu">
  <button mat-menu-item *ngFor="let d of trip?.droppingPoints" (click)="onSelectDroppingPoint(d)">
    {{ d?.name }}
  </button>
</mat-menu>

<app-confirm-dialog #confirm></app-confirm-dialog>